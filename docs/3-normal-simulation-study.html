<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bayesian Reproducibility</title>
  <meta name="description" content="Bayesian Reproducibility">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Bayesian Reproducibility" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Bayesian Reproducibility" />
  
  
  

<meta name="author" content="Huijia Yu">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="2-models.html">
<link rel="next" href="4-hierarchical-simulations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="1-lit-review.html"><a href="1-lit-review.html"><i class="fa fa-check"></i><b>1</b> Literature Review</a></li>
<li class="chapter" data-level="2" data-path="2-models.html"><a href="2-models.html"><i class="fa fa-check"></i><b>2</b> Models</a><ul>
<li class="chapter" data-level="2.1" data-path="2-models.html"><a href="2-models.html#fully-bayesian-model"><i class="fa fa-check"></i><b>2.1</b> Fully Bayesian Model</a></li>
<li class="chapter" data-level="2.2" data-path="2-models.html"><a href="2-models.html#conditional-likelihood"><i class="fa fa-check"></i><b>2.2</b> Conditional Likelihood</a></li>
<li class="chapter" data-level="2.3" data-path="2-models.html"><a href="2-models.html#bayes-factor-model"><i class="fa fa-check"></i><b>2.3</b> Bayes Factor Model</a></li>
<li class="chapter" data-level="2.4" data-path="2-models.html"><a href="2-models.html#prior-specifications"><i class="fa fa-check"></i><b>2.4</b> Prior Specifications</a></li>
<li class="chapter" data-level="2.5" data-path="2-models.html"><a href="2-models.html#methods"><i class="fa fa-check"></i><b>2.5</b> Methods</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html"><i class="fa fa-check"></i><b>3</b> Normal Simulation Study</a><ul>
<li class="chapter" data-level="3.1" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#data-generation"><i class="fa fa-check"></i><b>3.1</b> Data Generation</a></li>
<li class="chapter" data-level="3.2" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#conditional-likelihood-1"><i class="fa fa-check"></i><b>3.2</b> Conditional Likelihood</a></li>
<li class="chapter" data-level="3.3" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#posterior-distribution"><i class="fa fa-check"></i><b>3.3</b> Posterior Distribution</a></li>
<li class="chapter" data-level="3.4" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#results"><i class="fa fa-check"></i><b>3.4</b> Results</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#estimators"><i class="fa fa-check"></i><b>3.4.1</b> Estimators</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#credible-and-confidence-intervals"><i class="fa fa-check"></i><b>3.4.2</b> Credible and Confidence Intervals</a></li>
<li class="chapter" data-level="3.4.3" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#coverage"><i class="fa fa-check"></i><b>3.4.3</b> Coverage</a></li>
<li class="chapter" data-level="3.4.4" data-path="3-normal-simulation-study.html"><a href="3-normal-simulation-study.html#hypothesis-rejection"><i class="fa fa-check"></i><b>3.4.4</b> Hypothesis Rejection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html"><i class="fa fa-check"></i><b>4</b> Hierarchical Simulations</a><ul>
<li class="chapter" data-level="4.1" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#data-generation-procedure"><i class="fa fa-check"></i><b>4.1</b> Data Generation Procedure</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#finding-discovery-sites"><i class="fa fa-check"></i><b>4.1.1</b> Finding “Discovery” Sites</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#results-1"><i class="fa fa-check"></i><b>4.2</b> Results</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#rmse-of-mu"><i class="fa fa-check"></i><b>4.2.1</b> RMSE of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="4.2.2" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#coverage-of-mu"><i class="fa fa-check"></i><b>4.2.2</b> Coverage of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="4.2.3" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#probability-of-association-xi"><i class="fa fa-check"></i><b>4.2.3</b> Probability of Association <span class="math inline">\(\xi\)</span></a></li>
<li class="chapter" data-level="4.2.4" data-path="4-hierarchical-simulations.html"><a href="4-hierarchical-simulations.html#sensitivity-of-conditional-likelihood-method-to-changes-in-alpha"><i class="fa fa-check"></i><b>4.2.4</b> Sensitivity of Conditional Likelihood Method to Changes in <span class="math inline">\(\alpha\)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-analysis-of-tp53.html"><a href="5-analysis-of-tp53.html"><i class="fa fa-check"></i><b>5</b> Analysis of TP53</a><ul>
<li class="chapter" data-level="5.1" data-path="5-analysis-of-tp53.html"><a href="5-analysis-of-tp53.html#models-1"><i class="fa fa-check"></i><b>5.1</b> Models</a></li>
<li class="chapter" data-level="5.2" data-path="5-analysis-of-tp53.html"><a href="5-analysis-of-tp53.html#results-2"><i class="fa fa-check"></i><b>5.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-conclusion.html"><a href="6-conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a></li>
<li class="chapter" data-level="7" data-path="7-supplementary-material.html"><a href="7-supplementary-material.html"><i class="fa fa-check"></i><b>7</b> Supplementary Material</a><ul>
<li class="chapter" data-level="7.1" data-path="7-supplementary-material.html"><a href="7-supplementary-material.html#jags-models"><i class="fa fa-check"></i><b>7.1</b> JAGS Models</a></li>
<li class="chapter" data-level="7.2" data-path="7-supplementary-material.html"><a href="7-supplementary-material.html#joint-analysis-of-tp53-snps"><i class="fa fa-check"></i><b>7.2</b> Joint Analysis of TP53 SNPs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Reproducibility</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="normal-simulation-study" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Normal Simulation Study</h1>
<p>This simulation study addresses on the first goal outlined in the introduction: if the data from one site is found to be significant, how can we report this discovery in a way that takes into account the winner’s curse?</p>
<div id="data-generation" class="section level2">
<h2><span class="header-section-number">3.1</span> Data Generation</h2>
<p>To test the hypothesis <span class="math inline">\(H_0: \mu = 0\)</span> versus <span class="math inline">\(H_1: \mu \neq 0\)</span>, a fixed proportion (set at 0.5) of null vs. alternative hypotheses are generated. For each hypothesis <span class="math inline">\(H_i\)</span>, let <span class="math inline">\(\mu_i = 0\)</span> in the null scenario and <span class="math inline">\(\mu_i \sim \textsf{N}(0,1)\)</span> in the alternative. The data <span class="math inline">\(Y_i\)</span> is generated from a normal distribution with mean <span class="math inline">\(\mu_i\)</span> and known variance 1, with sample size 100. If <span class="math inline">\(Y_i\)</span> is not significant at <span class="math inline">\(\alpha = .05\)</span>, it is sampled again from the same distribution until the sufficient statistic is significant. This is done in order to properly compare the Bayesian approach with the conditional likelihood, which requires the data to be significant. The Bayes factor model as it is specified cannot be used in this scenario, since it only uses the p-value from the discovery site(s).</p>
</div>
<div id="conditional-likelihood-1" class="section level2">
<h2><span class="header-section-number">3.2</span> Conditional Likelihood</h2>
<p>The credible intervals were estimated by treating the conditional likelihood as if it were a posterior distribution with an improper prior <span class="math inline">\(p(\mu) = 1\)</span>, and obtaining the HPD region covering 95%. Sampling was done through a Metropolis-Hastings algorithm.</p>
</div>
<div id="posterior-distribution" class="section level2">
<h2><span class="header-section-number">3.3</span> Posterior Distribution</h2>
<p>In the Bayesian case, the prior was set to the mixture model <span class="math inline">\(p(\mu|\xi) = (1-\xi ) \delta_0(\mu)+ \xi\phi(\mu)\)</span>. In this case, <span class="math inline">\(\xi = 0.5\)</span> is a constant. Note that this is also the true data generating model.</p>
<p>The marginal posterior distribution is <span class="math inline">\(P(\mu | Y ) = P(H_0|Y)P(\mu|Y, H_0) + P(H_1|Y)P(\mu|Y, H_1)\)</span>. The separate posteriors for <span class="math inline">\(\mu\)</span> are: <span class="math inline">\(P(\mu|Y, H_0) = \delta_0(\mu)\)</span>, <span class="math inline">\(P(\mu|Y, H_1) \sim \textsf{N}(\frac{n}{n+1}\bar Y, \frac{1}{n+1})\)</span>. The posterior for the alternative hypothesis can be calculated using its Bayes factor, BF and the prior odds, <span class="math inline">\(\pi = \frac{(1-\xi)}{\xi}\)</span>: <span class="math display">\[P(H_1| Y ) = \frac{\pi BF}{1+\pi BF}\]</span>. For this example, the prior odds are 1 (because the probability of <span class="math inline">\(H_1 = \xi = 0.5\)</span>). The Bayes factor is <span class="math display">\[BF = \frac{L(\bar Y | H_1)}{L(\bar Y | H_0)} = \sqrt{n+1}* e^{\frac{n^2}{2(n+1)}(\bar Y)^2}\]</span> . This result comes from the fact that the marginal likelihood <span class="math inline">\(L(\bar Y | H_1) \sim \textsf{N}(0, \frac{n}{n+1})\)</span>.</p>
<p>Putting these pieces together results in the marginal posterior for <span class="math inline">\(\mu\)</span>, which can be used to generate samples to calculate credible intervals.</p>
</div>
<div id="results" class="section level2">
<h2><span class="header-section-number">3.4</span> Results</h2>
<div id="estimators" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Estimators</h3>
<p><img src="thesis_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<table>
<caption><span id="tab:unnamed-chunk-10">Table 3.1: </span>RMSE of 100 simulations</caption>
<thead>
<tr class="header">
<th align="right">Bayes.mean</th>
<th align="right">Bayes.median</th>
<th align="right">Bayes.mode</th>
<th align="right">cond.mean</th>
<th align="right">cond.mode</th>
<th align="right">naive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3.81</td>
<td align="right">4.329</td>
<td align="right">4.329</td>
<td align="right">3.932</td>
<td align="right">3.869</td>
<td align="right">4.986</td>
</tr>
</tbody>
</table>
<p>The conditional likelihood mode (i.e. MLE) has the smallest bias (absolute error) for <span class="math inline">\(\mu\)</span> out of the frequentist estimators, while the Bayesian median and mode (which end up being the same) the smallest bias in the Bayesian framework. The RMSE for the Bayesian estimator (mean of the posterior) is the lowest, followed by the conditional mean and mode.</p>
</div>
<div id="credible-and-confidence-intervals" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Credible and Confidence Intervals</h3>
<p><img src="thesis_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The lines mark the <span class="math inline">\(y = x\)</span> line, and the length of naive confidence intervals (which are constant for fixed number of samples) on the x and y axes.</p>
<p>The largest values for the significant statistic also correspond to the largest intervals in both cases. Note that the conditional likelihood credible intervals are almost always larger than the fully Bayesian credible intervals, but still mostly smaller than the naive ones.</p>
</div>
<div id="coverage" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Coverage</h3>
<p>The marginal coverage of the conditional likelihood credible interval C is <span class="math display">\[P(\mu \in C|Y) = P(\mu \in C|H_0) P(H_0|Y)+P(\mu \in C|H_1) P(H_1|Y)\]</span> This will be significantly higher than .95 for the cases in which <span class="math inline">\(0 \in C\)</span>, since <span class="math inline">\(P(\mu \in C|H_1) =0.95\)</span> by definition, and <span class="math inline">\(P(\mu \in C|H_0) = I_{0 \in C}\)</span>. In this experiment, the expected coverage is <span class="math inline">\(0.98\)</span> for intervals with 0, and only <span class="math inline">\(0.38\)</span> for those that do not contain 0.</p>
<p>However, conditioning on the alternative hypothesis does not lead to an empirical coverage of 95%.</p>
<p>We can see that both methods are still significantly better than the naive one.</p>
<table>
<caption><span id="tab:unnamed-chunk-12">Table 3.2: </span>Empirical Coverage for 95% Confidence/Credible Intervals</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Unconditional Coverage</th>
<th align="right">Coverage Conditional on H0</th>
<th align="right">Coverage Conditional on H1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>naive</td>
<td align="right">0.657</td>
<td align="right">0.624</td>
<td align="right">0.745</td>
</tr>
<tr class="even">
<td>conditional</td>
<td align="right">0.881</td>
<td align="right">1.000</td>
<td align="right">0.571</td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td align="right">0.882</td>
<td align="right">1.000</td>
<td align="right">0.577</td>
</tr>
</tbody>
</table>
</div>
<div id="hypothesis-rejection" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Hypothesis Rejection</h3>
<p>Due to the nature of p-values, an <span class="math inline">\(\alpha = 0.05\)</span> corresponds to a marginal posterior probability <span class="math inline">\(P(H_1 | Y )\)</span> of only <span class="math inline">\(0.4\)</span> for <span class="math inline">\(N = 100\)</span>. This means that the 95% credible interval for <span class="math inline">\(\mu| Y\)</span> will contain 0 every time. In terms of hypothesis testing, if we consider the strategy of rejecting the null when the interval does not contain 0, this level for <span class="math inline">\(\alpha\)</span> leads to no rejections.</p>
<table>
<caption><span id="tab:unnamed-chunk-13">Table 3.3: </span>Naive method</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
<th align="right">Reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.272</td>
<td align="right">0.45</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.137</td>
<td align="right">0.14</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:unnamed-chunk-14">Table 3.4: </span>Conditional Likelihood Method</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.722</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.278</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:unnamed-chunk-15">Table 3.5: </span>Bayesian Mixture Model</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.722</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.278</td>
</tr>
</tbody>
</table>
<p>Despite never rejecting the null, the conditional likelihood and the Bayesian methods both perform better than the naive one in terms of “predicting” accurately. The naive method is especially problematic in that it has a higher Type 1 error (false positives) than true positives OR true negatives in the region of the data.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="2-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4-hierarchical-simulations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
