<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>My Final College Paper</title>
  <meta name="description" content="My Final College Paper">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="My Final College Paper" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="My Final College Paper" />
  
  
  

<meta name="author" content="Huijia Yu">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="3-lit-review.html">
<link rel="next" href="5-hierarchical-model-simulation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="1-abstract.html"><a href="1-abstract.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="2-intro.html"><a href="2-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="3-lit-review.html"><a href="3-lit-review.html"><i class="fa fa-check"></i><b>3</b> Literature Review</a></li>
<li class="chapter" data-level="4" data-path="4-simulation-study.html"><a href="4-simulation-study.html"><i class="fa fa-check"></i><b>4</b> Simulation Study</a><ul>
<li class="chapter" data-level="4.1" data-path="4-simulation-study.html"><a href="4-simulation-study.html#normal-example"><i class="fa fa-check"></i><b>4.1</b> Normal Example</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-simulation-study.html"><a href="4-simulation-study.html#data-generation"><i class="fa fa-check"></i><b>4.1.1</b> Data Generation</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-simulation-study.html"><a href="4-simulation-study.html#conditional-likelihood"><i class="fa fa-check"></i><b>4.1.2</b> Conditional Likelihood</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-simulation-study.html"><a href="4-simulation-study.html#posterior-distribution"><i class="fa fa-check"></i><b>4.1.3</b> Posterior Distribution</a></li>
<li class="chapter" data-level="4.1.4" data-path="4-simulation-study.html"><a href="4-simulation-study.html#results"><i class="fa fa-check"></i><b>4.1.4</b> Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-hierarchical-model-simulation.html"><a href="5-hierarchical-model-simulation.html"><i class="fa fa-check"></i><b>5</b> Hierarchical Model Simulation</a></li>
<li class="chapter" data-level="6" data-path="6-application.html"><a href="6-application.html"><i class="fa fa-check"></i><b>6</b> Application</a><ul>
<li class="chapter" data-level="6.1" data-path="6-application.html"><a href="6-application.html#genome-study"><i class="fa fa-check"></i><b>6.1</b> Genome Study</a><ul>
<li class="chapter" data-level="6.1.1" data-path="6-application.html"><a href="6-application.html#eda"><i class="fa fa-check"></i><b>6.1.1</b> EDA</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-application.html"><a href="6-application.html#models"><i class="fa fa-check"></i><b>6.1.2</b> model(s)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">My Final College Paper</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation-study" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Simulation Study</h1>
<div id="normal-example" class="section level2">
<h2><span class="header-section-number">4.1</span> Normal Example</h2>
<div id="data-generation" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Data Generation</h3>
<p>To test the hypothesis <span class="math inline">\(H_0: mu = 0\)</span> versus <span class="math inline">\(H_1: mu \neq 0\)</span>, a fixed proportion (set at 0.5) of null vs. alternative hypotheses are generated. For each hypothesis <span class="math inline">\(H_i\)</span>, let <span class="math inline">\(mu_i = 0\)</span> in the null scenario and <span class="math inline">\(mu_i \sim N(0,1)\)</span> in the alternative. The data <span class="math inline">\(Y_i\)</span> is generated from a normal distribution with mean <span class="math inline">\(mu_i\)</span> and known variance 1, with sample size 100. If <span class="math inline">\(Y_i\)</span> is not significant at <span class="math inline">\(alpha = .05\)</span>, it is sampled again from the same distribution until the sufficient statistic is significant. This is done in order to properly compare the Bayesian approach with the frequentist one, which is conditional on the data being significant.</p>
</div>
<div id="conditional-likelihood" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Conditional Likelihood</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cond.posterior&lt;-<span class="st"> </span><span class="cf">function</span>(Y, n.samp){
  cond.likelihood&lt;-<span class="st"> </span><span class="cf">function</span>(Y, mu){
    ybar =<span class="st"> </span><span class="kw">mean</span>(Y)
    N =<span class="st"> </span><span class="kw">length</span>(Y)
    <span class="co">#(abs(ybar-mu)/(sqrt(1/N))&gt;1.96)*</span>
    <span class="kw">dnorm</span>(ybar, mu, <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N))<span class="op">/</span>
<span class="st">      </span>(<span class="kw">pnorm</span>((<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)), mu, <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N))
       <span class="op">+</span><span class="dv">1</span><span class="op">-</span><span class="kw">pnorm</span>((<span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)), mu, <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)))
    <span class="co">#not symmetric other than mu = 0</span>
  }
  <span class="co">#x&lt;- seq(-2,2,.01)</span>
  <span class="co">#plot(x, cond.likelihood(Y, x), type=&quot;l&quot;)</span>
  <span class="co">#metropolis hasting with flat prior</span>
  c=<span class="dv">1</span>
  mu &lt;-<span class="st"> </span><span class="dv">0</span>
  MU &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  <span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n.samp){
    mu.star &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, mu, c)
    r =<span class="st"> </span><span class="kw">cond.likelihood</span>(Y,mu.star)<span class="op">/</span><span class="kw">cond.likelihood</span>(Y,mu)
    <span class="cf">if</span>(<span class="kw">runif</span>(<span class="dv">1</span>)<span class="op">&lt;</span>r){
      mu &lt;-<span class="st"> </span>mu.star
    }
    MU &lt;-<span class="st"> </span><span class="kw">c</span>(MU, mu)
  }
  <span class="co">#plot(MU, type=&quot;l&quot;)</span>
  <span class="co">#ggplot(data = data.frame(MU))+geom_density(aes(x=MU))</span>
  (MU)
}</code></pre></div>
<p>Let <span class="math inline">\(B\)</span> indicate that the data is significant at the level <span class="math inline">\(\alpha\)</span>. The conditional likelihood <span class="math inline">\(L(\mu | B) = \frac{P(Y| \mu)P(B| Y,\mu)}{P(B|\mu)} = \frac{P(Y| \mu)}{\int_{\text{significant Y}} P(t| \mu) dt }\)</span>.<references here?> In this case, the sufficient statistic can be used to simplify: since <span class="math inline">\(\bar Y \sim N(\mu, \sigma^2/n)\)</span>, the conditional likelihood for the simulated data is equivalent to <span class="math inline">\(L(\mu|\bar Y) = \frac{\phi((\bar Y-\mu)/\sqrt{n})}{\Phi(Z_{\alpha/2}-\mu\sqrt{n})+\Phi(Z_{1-\alpha/2}-\mu\sqrt{n})}\)</span>.</p>
<p>Since this likelihood is difficult to integrate analytically, the confidence intervals were estimated by treating the conditional likelihood as if it were a posterior distribution with an improper prior <span class="math inline">\(\pi(\mu) = 1\)</span>, and obtaining the HPD (highest posterior density) region covering 95%. Sampling was done through a Metropolis-Hastings algorithm.</p>
</div>
<div id="posterior-distribution" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Posterior Distribution</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">getposterior &lt;-<span class="st"> </span><span class="cf">function</span>(Y,n.samp, <span class="dt">pi =</span> .<span class="dv">5</span>){
  n =<span class="st"> </span><span class="kw">length</span>(Y)
  odds =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pi)<span class="op">/</span>pi
  <span class="co">#bf.approx &lt;- -exp(1)*p*log(p)</span>
  bf &lt;-<span class="st">  </span>(n<span class="op">+</span><span class="dv">1</span>)<span class="op">^</span>(<span class="op">-</span>.<span class="dv">5</span>)<span class="op">*</span><span class="kw">exp</span>(n<span class="op">^</span><span class="dv">2</span><span class="op">*</span><span class="kw">mean</span>(Y)<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>(n<span class="op">+</span><span class="dv">1</span>)))
  alt.prob &lt;-<span class="st"> </span>odds<span class="op">*</span>bf<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>odds<span class="op">*</span>bf)
  <span class="co">#alt.prob.approx &lt;- odds*bf.approx/(1+odds*bf.approx)</span>

  <span class="co">#draws from posterior-flip a coin (ber w prob P(H given Y) and then use that to get draw</span>
  draws =<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">runif</span>(n.samp), <span class="cf">function</span>(x)  {
    <span class="kw">ifelse</span>(x<span class="op">&lt;</span>(<span class="dv">1</span><span class="op">-</span>alt.prob), <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">rnorm</span>(<span class="dv">1</span>,<span class="kw">mean</span>(Y)<span class="op">*</span>n<span class="op">/</span>(n<span class="op">+</span><span class="dv">1</span>), <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>(n<span class="op">+</span><span class="dv">1</span>))))
  })
  <span class="co">#ggplot(data = data.frame(draws))+geom_density(aes(x=draws))</span>
  (<span class="kw">list</span>(<span class="dt">alt.prob=</span>alt.prob, <span class="dt">draws=</span>draws)) 
  
}</code></pre></div>
<p>Let <span class="math inline">\(\delta_a(x)\)</span> be the Dirac delta function: <span class="math inline">\(\delta_a(x) = 1\)</span> for <span class="math inline">\(x = a\)</span> and <span class="math inline">\(\delta_a(x)=0\)</span> otherwise. In the Bayesian case, the prior was set to a spike and slab prior, with the “spike” being a point mass at 0: <span class="math inline">\(\pi(\mu|H=H_0) = \delta_0(\mu)\)</span>, and the “slab” part corresponding to a unit information prior: <span class="math inline">\(\pi(\mu|H=H_1) \sim N(0, 1)\)</span>. The full prior is a mixture model <span class="math inline">\(\pi(\mu|\xi) = (1-\xi ) \delta_0(\mu)+ \xi\phi(\mu)\)</span>. In this case, <span class="math inline">\(\xi = 0.5\)</span> is a constant. Note that this is also the true data generating model.</p>
<p>The marginal posterior distribution is <span class="math inline">\(P(\mu | Y ) = P(H_0|Y)P(\mu|Y, H_0) + P(H_1|Y)P(\mu|Y, H_1)\)</span>. The separate posteriors for <span class="math inline">\(\mu\)</span> are: <span class="math inline">\(P(\mu|Y, H_0) = \delta_0(\mu)\)</span>, <span class="math inline">\(P(\mu|Y, H_1) \sim N(\frac{n}{n+1}\bar Y, \frac{1}{n+1})\)</span>. The posterior for the alternative hypothesis can be calculated using its bayes factor, BF and the prior odds, <span class="math inline">\(\pi = \frac{(1-\xi)}{\xi}\)</span>: <span class="math inline">\(P(H_1| Y ) = \frac{\pi BF}{1+\pi BF}\)</span>. For this example, the prior odds are 1 (because the probability of <span class="math inline">\(H_1 = \xi = 0.5\)</span>). The bayes factor <span class="math inline">\(BF = \frac{L(\bar Y | H_1)}{L(\bar Y | H_0)} = \sqrt{n+1} exp(\frac{n^2}{2(n+1)}(\bar Y)^2)\)</span>. This result comes from the fact that the marginal likelihood <span class="math inline">\(L(\bar Y | H_1) \sim N(0, \frac{n}{n+1})\)</span>.</p>
<p>Putting these pieces together results in the marginal posterior for <span class="math inline">\(\mu\)</span>, which can be used to generate samples to calculate HPD credible intervals.</p>
<p>While true HPD intervals can be disjoint, the intervals calculated for this experiment are actually the shortest continuous segments covering <span class="math inline">\(.95\)</span>. This corresponds to the HPD interval under the assumption that the distribution is not severely multimodal, and is what most packages in R use to estimate HPD intervals. However, since this posterior is actually a mixture model, a large enough posterior probability for <span class="math inline">\(H_1\)</span> could lead to a difference between the true HPD credible interval and the calculated one. <this will be addressed in the future etc></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HPD &lt;-<span class="cf">function</span>(post, <span class="dt">prob  =</span> .<span class="dv">95</span>){
  
  <span class="co">#HPD interval- copied from BAS/coda</span>
  obj &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(post)
  vals &lt;-<span class="st"> </span><span class="kw">apply</span>(obj, <span class="dv">2</span>, sort)
  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.matrix</span>(vals))
    <span class="kw">stop</span>(<span class="st">&quot;obj must have nsamp &gt; 1&quot;</span>)
  nsamp &lt;-<span class="st"> </span><span class="kw">nrow</span>(vals)
  npar &lt;-<span class="st"> </span><span class="kw">ncol</span>(vals)
  gap &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="kw">min</span>(nsamp <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">round</span>(nsamp <span class="op">*</span><span class="st"> </span>prob)))
  init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(nsamp <span class="op">-</span><span class="st"> </span>gap)
  inds &lt;-<span class="st"> </span><span class="kw">apply</span>(vals[init <span class="op">+</span><span class="st"> </span>gap, , <span class="dt">drop =</span> <span class="ot">FALSE</span>] <span class="op">-</span><span class="st"> </span>vals[init,
                                                        , <span class="dt">drop =</span> <span class="ot">FALSE</span>], <span class="dv">2</span>, which.min)
  (<span class="kw">cbind</span>(vals[<span class="kw">cbind</span>(inds, <span class="dv">1</span><span class="op">:</span>npar)], vals[<span class="kw">cbind</span>(inds <span class="op">+</span>
<span class="st">                                                 </span>gap, <span class="dv">1</span><span class="op">:</span>npar)]))
  <span class="co">#look into this and check about continuity of cdf, etc</span>
}</code></pre></div>
</div>
<div id="results" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Results</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all &lt;-<span class="st"> </span><span class="cf">function</span>(H, N, n.samp, interval,alpha){
  mu &lt;-<span class="st"> </span><span class="kw">ifelse</span>(H<span class="op">==</span><span class="dv">0</span>, <span class="dv">0</span>, <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) ### normally distributed mu
  Y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, mu, <span class="dv">1</span>)
  count=<span class="dv">0</span>
  <span class="cf">while</span>(<span class="kw">abs</span>(<span class="kw">abs</span>(<span class="kw">mean</span>(Y))<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)<span class="op">-</span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>))<span class="op">&gt;</span>interval){ <span class="co">#if Z is not in (1.94, 1.98)</span>
    <span class="cf">if</span>(count<span class="op">&gt;</span><span class="dv">1000</span>){ <span class="co">#had to add this bc it wouldn&#39;t run</span>
      <span class="kw">return</span> (<span class="kw">c</span>(H, mu , <span class="kw">mean</span>(Y), <span class="ot">NA</span>  , 
                <span class="ot">NA</span>  , <span class="ot">NA</span>  , 
                <span class="ot">NA</span> , <span class="ot">NA</span> , 
                <span class="ot">NA</span> , <span class="ot">NA</span> , <span class="ot">NA</span>, <span class="ot">NA</span>  , <span class="ot">NA</span>  , 
                <span class="ot">NA</span> , <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span> ))
    }
    
    Y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, mu, <span class="dv">1</span>)
    count&lt;-<span class="st"> </span>count<span class="op">+</span><span class="dv">1</span>
  }
  post &lt;-<span class="st"> </span><span class="kw">getposterior</span>(Y,  n.samp)
  alt.prob =<span class="st"> </span>post<span class="op">$</span>alt.prob
  cred &lt;-<span class="st"> </span><span class="kw">HPD</span>(post<span class="op">$</span>draws)
  cred.lower =<span class="st"> </span>cred[<span class="dv">1</span>]
  cred.upper =<span class="st"> </span>cred[<span class="dv">2</span>]
  bayes.cov =<span class="st">  </span>(cred.upper<span class="op">&gt;=</span>mu<span class="op">&amp;&amp;</span>cred.lower<span class="op">&lt;=</span>mu)
  
  cond &lt;-<span class="kw">cond.posterior</span>(Y, n.samp)
  conf &lt;-<span class="st"> </span><span class="kw">HPD</span>(cond)
  conf.lower =<span class="st"> </span>conf[<span class="dv">1</span>]
  conf.upper =<span class="st"> </span>conf[<span class="dv">2</span>]
  
  freq.cov =<span class="st">  </span>(conf.upper<span class="op">&gt;=</span>mu<span class="op">&amp;&amp;</span>conf.lower<span class="op">&lt;=</span>mu)
  naive.cov &lt;-<span class="st"> </span><span class="kw">mean</span>(Y)<span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)<span class="op">&gt;=</span>mu<span class="op">&amp;&amp;</span><span class="kw">mean</span>(Y)<span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span>N)<span class="op">&lt;=</span>mu 
  expected.cov &lt;-<span class="st"> </span>.<span class="dv">95</span><span class="op">*</span>alt.prob<span class="op">+</span>(conf.upper<span class="op">&gt;=</span><span class="dv">0</span><span class="op">&amp;&amp;</span>conf.lower<span class="op">&lt;=</span><span class="dv">0</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alt.prob)
  
  
  bayes.est =<span class="st"> </span><span class="kw">mean</span>(post<span class="op">$</span>draws)
  bayes.median.est =<span class="st"> </span><span class="kw">median</span>(post<span class="op">$</span>draws)
  bayes.mode.est =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">names</span>(<span class="kw">sort</span>(<span class="op">-</span><span class="kw">table</span>(post<span class="op">$</span>draws)))[<span class="dv">1</span>])
  cond.mean.est =<span class="st"> </span><span class="kw">mean</span>(cond)
  d &lt;-<span class="st"> </span><span class="kw">density</span>(cond)
  cond.mode.est =<span class="st"> </span>d<span class="op">$</span>x[<span class="kw">which.max</span>(d<span class="op">$</span>y)]
  
  (<span class="kw">c</span>(H, mu , <span class="kw">mean</span>(Y), alt.prob  , 
     cred.lower  , cred.upper  , 
     conf.lower , conf.upper , 
     bayes.cov , freq.cov , naive.cov, expected.cov, 
     bayes.est, bayes.median.est,
     bayes.mode.est,cond.mean.est,cond.mode.est))
  
}


N=<span class="dv">100</span>; n.samp =<span class="st"> </span><span class="dv">10000</span>; n.sim=<span class="dv">1000</span>; pi =<span class="st"> </span>.<span class="dv">5</span>

results &lt;-<span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">apply</span>(<span class="kw">matrix</span>(<span class="kw">as.numeric</span>(<span class="kw">runif</span>(n.sim)<span class="op">&lt;</span>pi)),<span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">all</span>(x, N, n.samp, .<span class="dv">2</span>, .<span class="dv">05</span>))))
<span class="kw">colnames</span>(results)&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;mu&quot;</span> , <span class="st">&quot;Ybar&quot;</span>, <span class="st">&quot;alt.prob&quot;</span> , 
        <span class="st">&quot;cred.lower&quot;</span>  , <span class="st">&quot;cred.upper&quot;</span>  , 
        <span class="st">&quot;conf.lower&quot;</span> , <span class="st">&quot;conf.upper&quot;</span> , 
        <span class="st">&quot;bayes.cov&quot;</span> , <span class="st">&quot;freq.cov&quot;</span> ,  <span class="st">&quot;naive.cov&quot;</span>, <span class="st">&quot;expected.cov&quot;</span>, 
        <span class="st">&quot;bayes.est&quot;</span>,<span class="st">&quot;bayes.median.est&quot;</span>,<span class="st">&quot;bayes.mode.est&quot;</span>,
        <span class="st">&quot;cond.mean.est&quot;</span>,<span class="st">&quot;cond.mode.est&quot;</span>)</code></pre></div>
<div id="estimators" class="section level4">
<h4><span class="header-section-number">4.1.4.1</span> Estimators</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##plot of estimators or mse
<span class="kw">require</span>(reshape2)</code></pre></div>
<pre><code>Loading required package: reshape2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(knitr)
<span class="kw">require</span>(ggplot2)
<span class="co">#load(&quot;normalresults.RData&quot;)</span>
<span class="co">#results &lt;- fullresults</span>
fullresults&lt;-results
results&lt;-<span class="kw">na.omit</span>(results)
estimators &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">bayes =</span> <span class="kw">abs</span>(results<span class="op">$</span>bayes.est<span class="op">-</span>results<span class="op">$</span>mu),
              <span class="dt">naive =</span> <span class="kw">abs</span>(results<span class="op">$</span>Ybar<span class="op">-</span>results<span class="op">$</span>mu), 
              <span class="dt">bayes.median =</span> <span class="kw">abs</span>(results<span class="op">$</span>bayes.median.est<span class="op">-</span>results<span class="op">$</span>mu),
              <span class="dt">bayes.mode =</span> <span class="kw">abs</span>(results<span class="op">$</span>bayes.mode.est<span class="op">-</span>results<span class="op">$</span>mu),
              <span class="dt">cond.mean =</span> <span class="kw">abs</span>(results<span class="op">$</span>cond.mean.est<span class="op">-</span>results<span class="op">$</span>mu),
              <span class="dt">cond.mode =</span> <span class="kw">abs</span>(results<span class="op">$</span>cond.mode.est<span class="op">-</span>results<span class="op">$</span>mu))

<span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">melt</span>(estimators), <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()<span class="op">+</span><span class="kw">labs</span>(<span class="dt">x=</span> <span class="st">&quot;Estimator&quot;</span>, <span class="dt">y=</span><span class="st">&quot;|Bias|&quot;</span>, <span class="dt">title=</span> <span class="st">&quot;Bias Distribution by Estimator&quot;</span>)</code></pre></div>
<pre><code>No id variables; using all as measure variables</code></pre>
<p><img src="thesis_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">c</span>(<span class="dt">bayes =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>bayes<span class="op">^</span><span class="dv">2</span>)), <span class="dt">bayes.median=</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>bayes.median<span class="op">^</span><span class="dv">2</span>)), <span class="dt">bayes.mode =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>bayes.mode<span class="op">^</span><span class="dv">2</span>)),<span class="dt">cond.mean =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>cond.mean<span class="op">^</span><span class="dv">2</span>)), <span class="dt">cond.mode =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>cond.mode<span class="op">^</span><span class="dv">2</span>)), <span class="dt">naive=</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimators<span class="op">$</span>naive<span class="op">^</span><span class="dv">2</span>))), <span class="dt">col.names =</span> <span class="st">&quot;RMSE&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bayes</td>
<td align="right">3.800356</td>
</tr>
<tr class="even">
<td>bayes.median</td>
<td align="right">4.319349</td>
</tr>
<tr class="odd">
<td>bayes.mode</td>
<td align="right">4.319687</td>
</tr>
<tr class="even">
<td>cond.mean</td>
<td align="right">3.922144</td>
</tr>
<tr class="odd">
<td>cond.mode</td>
<td align="right">3.911237</td>
</tr>
<tr class="even">
<td>naive</td>
<td align="right">5.015428</td>
</tr>
</tbody>
</table>
<p>The conditional likelihood mode (i.e. MLE) has the smallest bias (absolute error) for <span class="math inline">\(\mu\)</span> out of the frequentist estimators, while the bayesian median and mode (which end up being the same) the smallest bias in the bayesian framework. The RMSE for the bayesian estimator (mean of the posterior) is the lowest, followed by the conditional mean and mode.</p>
</div>
<div id="credible-and-confidence-intervals" class="section level4">
<h4><span class="header-section-number">4.1.4.2</span> Credible and Confidence Intervals</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##plot of credible interval sizes
<span class="kw">ggplot</span>(<span class="dt">data =</span> results)<span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conf.upper<span class="op">-</span>conf.lower, <span class="dt">y =</span> cred.upper<span class="op">-</span>cred.lower, <span class="dt">colour =</span> <span class="kw">abs</span>(Ybar)))<span class="op">+</span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>)<span class="op">+</span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">2</span><span class="op">*</span><span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>))<span class="op">+</span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">2</span><span class="op">*</span><span class="fl">1.96</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>))<span class="op">+</span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Length of (Conditional) Confidence Interval&quot;</span>,<span class="dt">y=</span><span class="st">&quot;Length of (Bayesian) Credible Interval&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Interval Size Comparison&quot;</span>,<span class="dt">color=</span><span class="st">&quot;|Ybar|&quot;</span>)</code></pre></div>
<p><img src="thesis_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The lines mark the <span class="math inline">\(y = x\)</span> line, and the length of naive confidence intervals (which are constant for fixed number of samples) on the x and y axes.</p>
<p>The largest values for the significant statistic also correspond to the largest intervals in both cases. Note that the conditional likelihood confidence intervals are almost always larger than the credible intervals, but still mostly smaller than the naive ones.</p>
</div>
<div id="coverage" class="section level4">
<h4><span class="header-section-number">4.1.4.3</span> Coverage</h4>
<p>The marginal coverage of the (frequentist conditional likelihood) confidence interval C, <span class="math inline">\(P(\mu \in C|Y) = P(\mu \in C|H_0) P(H_0|Y)+P(\mu \in C|H_1) P(H_1|Y)\)</span> will be significantly higher than .95 for the cases in which <span class="math inline">\(0 \in C\)</span>, since <span class="math inline">\(P(\mu \in C|H_1) =0.95\)</span> by definition, and <span class="math inline">\(P(\mu \in C|H_0) = I_{0 \in C}\)</span>. In this experiment, the expected coverage is <span class="math inline">\(0.98\)</span> for intervals with 0, and only <span class="math inline">\(0.38\)</span> for those that do not contain 0.</p>
<p>However, conditioning on the alternative hypothesis does not lead to an empirical coverage of 95%.</p>
<p>We can see that both methods are still significantly better than the naive one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#table of expected vs empirical coverage</span>

results &lt;-<span class="st"> </span><span class="kw">na.omit</span>(results)
b &lt;-<span class="st"> </span><span class="kw">which</span>(results<span class="op">$</span>H<span class="op">==</span><span class="dv">0</span>)

<span class="kw">kable</span>(<span class="kw">t</span>(<span class="kw">data.frame</span>(<span class="dt">naive =</span> <span class="kw">c</span>(<span class="kw">mean</span>(results<span class="op">$</span>naive.cov),<span class="kw">mean</span>(results[b,]<span class="op">$</span>naive.cov),<span class="kw">mean</span>(results[<span class="op">-</span>b,]<span class="op">$</span>naive.cov)), 
        <span class="dt">conditional =</span> <span class="kw">c</span>(<span class="kw">mean</span>(results<span class="op">$</span>freq.cov), <span class="kw">mean</span>(results[b,]<span class="op">$</span>freq.cov), <span class="kw">mean</span>(results[<span class="op">-</span>b,]<span class="op">$</span>freq.cov)),
        <span class="dt">bayesian =</span> <span class="kw">c</span>(<span class="kw">mean</span>(results<span class="op">$</span>bayes.cov), <span class="kw">mean</span>(results[b,]<span class="op">$</span>bayes.cov), <span class="kw">mean</span>(results[<span class="op">-</span>b,]<span class="op">$</span>bayes.cov)))),
      <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Unconditional Coverage&quot;</span>,<span class="st">&quot;Coverage Conditional on H0&quot;</span>, <span class="st">&quot;Coverage Conditional on H1&quot;</span>), 
      <span class="dt">row.names =</span> <span class="ot">TRUE</span>,
      <span class="dt">caption =</span> <span class="st">&quot;Empirical Coverage for 95% Confidence/Credible Intervals&quot;</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-7">Table 4.1: </span>Empirical Coverage for 95% Confidence/Credible Intervals</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Unconditional Coverage</th>
<th align="right">Coverage Conditional on H0</th>
<th align="right">Coverage Conditional on H1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>naive</td>
<td align="right">0.6248276</td>
<td align="right">0.5761719</td>
<td align="right">0.7417840</td>
</tr>
<tr class="even">
<td>conditional</td>
<td align="right">0.8827586</td>
<td align="right">1.0000000</td>
<td align="right">0.6009390</td>
</tr>
<tr class="odd">
<td>bayesian</td>
<td align="right">0.8868966</td>
<td align="right">1.0000000</td>
<td align="right">0.6150235</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#kable(c(naive = , conditional = ,bayesian = mean(results[b,]$bayes.cov)), col.names = c(&quot;Empirical Coverage&quot;), caption = &quot;coverage for 95% confidence/credible intervals conditional on H0&quot;)</span>
<span class="co">#kable(c(naive =c(0) , conditional = mean(results[-b,]$freq.cov),bayesian = mean(results[-b,]$bayes.cov)), col.names = c(&quot;Empirical Coverage&quot;), caption = &quot;coverage for 95% confidence/credible intervals conditional on H1&quot;)</span></code></pre></div>
</div>
<div id="hypothesis-rejection" class="section level4">
<h4><span class="header-section-number">4.1.4.4</span> Hypothesis Rejection(??)</h4>
<p>Due to the nature of p-values, an <span class="math inline">\(\alpha = 0.05\)</span> corresponds to a posterior probability <span class="math inline">\(P(H_1 | Y )\)</span> of only <span class="math inline">\(0.4\)</span> for <span class="math inline">\(N = 100\)</span>. This means that the 95% credible interval for <span class="math inline">\(\mu| Y\)</span> will contain 0 every time. In terms of hypothesis testing, if we consider the strategy of rejecting the null when the interval does not contain 0, this level for <span class="math inline">\(\alpha\)</span> leads to no rejections.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##confusion matrices
<span class="kw">kable</span>(<span class="kw">table</span>(results<span class="op">$</span>H,<span class="kw">abs</span>(results<span class="op">$</span>Ybar)<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)<span class="op">&lt;</span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span><span class="fl">0.05</span><span class="op">/</span><span class="dv">2</span>))<span class="op">/</span><span class="kw">dim</span>(results)[<span class="dv">1</span>], <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Do not reject null&quot;</span>, <span class="st">&quot;Reject null&quot;</span>), <span class="dt">row.names =</span> <span class="ot">TRUE</span>, <span class="dt">caption =</span> <span class="st">&quot;Naive method&quot;</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-8">Table 4.2: </span>Naive method</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
<th align="right">Reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.2993103</td>
<td align="right">0.4068966</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.1558621</td>
<td align="right">0.1379310</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">table</span>(results<span class="op">$</span>H,results<span class="op">$</span>conf.upper<span class="op">&gt;=</span><span class="dv">0</span><span class="op">&amp;</span>results<span class="op">$</span>conf.lower<span class="op">&lt;=</span><span class="dv">0</span>)<span class="op">/</span><span class="kw">dim</span>(results)[<span class="dv">1</span>], <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Do not reject null&quot;</span>), <span class="dt">row.names =</span> <span class="ot">TRUE</span>, <span class="dt">caption =</span> <span class="st">&quot;Conditional Likelihood Method&quot;</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-8">Table 4.2: </span>Conditional Likelihood Method</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.7062069</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.2937931</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">table</span>(results<span class="op">$</span>H,results<span class="op">$</span>cred.upper<span class="op">&gt;=</span><span class="dv">0</span><span class="op">&amp;</span>results<span class="op">$</span>cred.lower<span class="op">&lt;=</span><span class="dv">0</span>)<span class="op">/</span><span class="kw">dim</span>(results)[<span class="dv">1</span>], <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Do not reject null&quot;</span>), <span class="dt">row.names =</span> <span class="ot">TRUE</span>, <span class="dt">caption =</span> <span class="st">&quot;Bayesian Mixture Model&quot;</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-8">Table 4.2: </span>Bayesian Mixture Model</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Do not reject null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td align="right">0.7062069</td>
</tr>
<tr class="even">
<td>1</td>
<td align="right">0.2937931</td>
</tr>
</tbody>
</table>
<p>Despite never rejecting the null, the conditional likelihood and the bayesian methods both perform better than the naive one in terms of “predicting” accurately. The naive method is especially problematic in that it has a higher Type 1 error (false positives) than true positives OR true negatives in the region of the data.</p>
<p><strong>## Double Exponential Simulation with Adjusted P-Values</strong></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="3-lit-review.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="5-hierarchical-model-simulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
